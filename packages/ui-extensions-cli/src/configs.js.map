{"version":3,"file":"configs.js","sourceRoot":"","sources":["configs.ts"],"names":[],"mappings":"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","sourcesContent":["import {readFileSync} from 'fs';\n\nimport {load} from 'js-yaml';\n\nexport interface CommandOptions {\n  env?: {[key: string]: string};\n}\n\nexport interface Configs {\n  development: Development;\n  extensionPoints?: string[];\n}\n\nexport interface ConfigFile {\n  development: Development;\n  extension_points?: string[];\n}\n\nexport interface Development {\n  entries: {[key: string]: string};\n  buildDir: string;\n  build?: CommandOptions;\n  develop?: CommandOptions;\n}\n\ninterface RequiredConfigs {\n  [key: string]: RequiredConfigs | boolean;\n}\n\ninterface Indexable {\n  [key: string]: any;\n}\n\nconst REQUIRED_CONFIGS: RequiredConfigs = {\n  development: {\n    build_dir: true,\n    entries: {main: true},\n  },\n};\n\nconst RESERVE_PATHS = flattenPaths({\n  development: {\n    build: {env: true},\n    develop: {env: true},\n  },\n});\n\nexport function getConfigs() {\n  const stdin = 0;\n\n  try {\n    const configs = load(readFileSync(stdin, 'utf8'));\n    if (!isValidConfigs(configs, REQUIRED_CONFIGS)) {\n      throw new Error('Invalid configuration');\n    }\n    return jsonConfigs(configs);\n  } catch (error) {\n    console.log(`Failed with error: ${error}`);\n    process.exit(1);\n  }\n}\n\nfunction toCamelCase(str: string) {\n  return str.replace(/_./g, (substr: string) => substr.toUpperCase()[1]);\n}\n\nfunction isValidConfigs(\n  configs: any,\n  requiredConfigs: RequiredConfigs,\n  paths: string[] = [],\n): configs is ConfigFile {\n  Object.keys(requiredConfigs).forEach((key) => {\n    const isRequired = requiredConfigs[key] !== false;\n    const value = configs[key];\n    if ((value === undefined || value === null) && isRequired) {\n      throw new Error(`Invalid configuration. Missing \\`${paths.concat(key).join('.')}\\``);\n    }\n    if (!Array.isArray(value) && typeof value === 'object') {\n      isValidConfigs(value, requiredConfigs[key] as RequiredConfigs, paths.concat(key));\n    }\n  }, {});\n  return true;\n}\n\nfunction jsonConfigs<T extends Indexable>(\n  configs: T,\n  paths: string[] = [],\n  formatter = toCamelCase,\n): T {\n  return Object.keys(configs).reduce((acc, key) => {\n    const shouldReserveKey = RESERVE_PATHS.includes(paths.concat(key).join('.'));\n    const formattedKey = formatter(key);\n    const value = configs[key];\n    if (Array.isArray(value) || typeof value !== 'object') {\n      return {\n        ...acc,\n        [formattedKey]: configs[key],\n      };\n    }\n    return {\n      ...acc,\n      [formattedKey]: jsonConfigs(\n        value,\n        paths.concat(key),\n        shouldReserveKey ? (key) => key : formatter,\n      ),\n    };\n  }, {} as T);\n}\n\nfunction flattenPaths(config: RequiredConfigs, paths: string[] = []): string[] {\n  return Object.keys(config).reduce((acc, key) => {\n    const value = config[key];\n    if (!value) {\n      return acc;\n    }\n    if (typeof value === 'object') {\n      return [...acc, ...flattenPaths(value, paths.concat(key))];\n    }\n    return [...acc, paths.concat(key).join('.')];\n  }, [] as string[]);\n}\n"]}